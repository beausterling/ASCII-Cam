---
phase: 03-ascii-rendering-engine
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - index.html
  - css/style.css
  - js/main.js
  - js/renderer.js
autonomous: false

must_haves:
  truths:
    - "User can adjust ASCII resolution via slider and sees column count label update in real time"
    - "User can select character set from dropdown and ASCII output changes immediately"
    - "User can toggle between raw video feed and ASCII output"
    - "Rendering maintains smooth performance on mobile (no jank during slider drag)"
  artifacts:
    - path: "index.html"
      provides: "Resolution slider, character set dropdown, video/ASCII toggle switch"
      contains: "ascii-columns-slider"
    - path: "js/main.js"
      provides: "Event handlers wiring controls to renderer setters"
      contains: "setColumns"
    - path: "css/style.css"
      provides: "Toggle switch styling and controls layout"
      contains: "toggle-switch"
  key_links:
    - from: "js/main.js"
      to: "js/renderer.js"
      via: "setColumns(), setCharSet(), setAsciiMode() calls"
      pattern: "setColumns|setCharSet|setAsciiMode"
    - from: "index.html #ascii-columns-slider"
      to: "js/main.js"
      via: "input event listener"
      pattern: "addEventListener.*input"
---

<objective>
Wire interactive controls for the ASCII rendering engine: resolution slider with live label, character set dropdown, and video/ASCII toggle switch.

Purpose: Users need real-time control over the ASCII experience — adjusting resolution, choosing visual styles, and switching between video and ASCII views.
Output: Fully interactive ASCII rendering with slider, dropdown, and toggle controls below the output area.
</objective>

<execution_context>
@/Users/beausterling/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beausterling/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ascii-rendering-engine/03-CONTEXT.md
@.planning/phases/03-ascii-rendering-engine/03-01-SUMMARY.md
@js/main.js
@js/renderer.js
@js/config.js
@index.html
@css/style.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: ASCII controls UI, event wiring, and throttled updates</name>
  <files>index.html, css/style.css, js/main.js, js/renderer.js</files>
  <action>
**index.html** — Add ASCII controls section BELOW the canvas/ASCII output area (controls below output per user decision):

1. Add a `<div id="ascii-controls">` section containing:

   a. **Resolution slider:**
      - `<input type="range" id="ascii-columns-slider" min="40" max="160" value="80" class="form-range">`
      - `<label id="ascii-columns-label">80 cols</label>` — shows live column count
      - Wrap in a flex/grid row with label visible next to or below the slider

   b. **Character set dropdown:**
      - `<select id="charset-select" class="form-select">` with 3 options:
        - `<option value="standard" selected>Standard</option>`
        - `<option value="dense">Dense</option>`
        - `<option value="minimal">Minimal</option>`

   c. **Video/ASCII toggle switch** (iOS-style per user decision):
      - Use a Bootstrap custom switch: `<div class="form-check form-switch">`
      - `<input class="form-check-input" type="checkbox" id="ascii-toggle" checked>` (checked = ASCII mode, which is the default)
      - `<label class="form-check-label" for="ascii-toggle">ASCII Mode</label>`

2. Place these controls in a centered layout below the canvas container. Use Bootstrap utility classes for spacing (`mt-3`, `gap-3`, etc.).

3. The controls section should be hidden by default (`style="display: none"`) and shown only when the camera is active (main.js will toggle visibility).

**css/style.css** — Style the controls section:

1. `#ascii-controls`: centered layout, max-width to prevent stretching too wide on desktop, padding for breathing room.

2. Style the range slider label to match the terminal aesthetic (monospace font, muted color).

3. Style the toggle switch — Bootstrap's form-switch provides the iOS-style look out of the box, but ensure the green accent color (#00ff00) is used for the checked state via CSS override: `.form-check-input:checked { background-color: #00ff00; border-color: #00ff00; }`.

4. Form controls (select, range) should use Bootstrap dark theme styling (already inherited from `data-bs-theme="dark"` on html element).

**js/main.js** — Wire the controls to renderer setters:

1. Import `setColumns`, `setCharSet`, `setAsciiMode` from `./renderer.js`.

2. Inside the DOMContentLoaded handler, get references to:
   - `#ascii-columns-slider`
   - `#ascii-columns-label`
   - `#charset-select`
   - `#ascii-toggle`
   - `#ascii-controls`

3. **Resolution slider** — Add `'input'` event listener (fires continuously during drag):
   - Implement throttle: create a `throttle(fn, ms)` utility function (or inline). Use 50ms throttle interval — provides smooth visual feedback without overwhelming mobile devices.
   - On throttled input: read `slider.value`, call `setColumns(parseInt(value))`, update label text to `${value} cols`.

4. **Character set dropdown** — Add `'change'` event listener:
   - Read `select.value`, call `setCharSet(value)`.

5. **Video/ASCII toggle** — Add `'change'` event listener:
   - Read `toggle.checked`, call `setAsciiMode(toggle.checked)`.
   - When toggling to video mode: could optionally hide the slider/dropdown since they don't affect video. But per simplicity, keep all controls visible.

6. **Show/hide controls with camera state:**
   - When camera starts successfully: show `#ascii-controls` (`asciiControlsEl.style.display = 'block'`)
   - When camera stops: hide `#ascii-controls` (`asciiControlsEl.style.display = 'none'`)

7. **FPS counter** — Add a debug-only FPS counter (console.log, NOT visible UI per user decision):
   - In renderer.js (not main.js): track frame timestamps, log FPS to console every 2-3 seconds.
   - Simple approach: count frames between `performance.now()` checks, log when interval exceeds 2000ms.
   - This goes in renderer.js draw() function. Add it as part of this task since it's small and renderer.js is already being modified.

**js/renderer.js** — Add FPS logging:

1. Add module-level FPS tracking variables: `let frameCount = 0; let lastFpsTime = performance.now();`

2. In draw(), after rendering: increment `frameCount`. If `performance.now() - lastFpsTime > 2000`, calculate FPS = `frameCount / ((now - lastFpsTime) / 1000)`, log `console.log('FPS:', fps.toFixed(1))`, reset counters.

**Throttle implementation note:** Use a simple closure-based throttle (NOT debounce — debounce delays the final update, throttle provides consistent feedback during drag). Pattern:
```javascript
function throttle(fn, limit) {
  let lastCall = 0;
  return function(...args) {
    const now = Date.now();
    if (now - lastCall >= limit) {
      lastCall = now;
      fn.apply(this, args);
    }
  };
}
```
  </action>
  <verify>
1. `npm run lint` passes with no new errors
2. `npm run format:check` passes
3. Open in browser, start camera — ASCII controls appear below the output
4. Drag resolution slider — column count label updates in real time, ASCII resolution changes visually
5. Change character set dropdown — ASCII appearance changes (standard vs dense vs minimal look distinct)
6. Toggle the ASCII/video switch — switches between ASCII art and raw video feed
7. Check browser console — FPS logging appears every ~2 seconds
8. Slider drag on mobile feels smooth (no jank or freezing)
  </verify>
  <done>
Resolution slider (40-160 cols) with live label, character set dropdown (3 options), and video/ASCII toggle switch are wired and working. Controls appear when camera starts and hide when camera stops. FPS logged to console for debugging. Slider updates are throttled at 50ms for mobile performance.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Mobile and desktop verification</name>
  <what-built>Complete ASCII rendering engine with interactive controls: live webcam-to-ASCII conversion, resolution slider (40-160 columns), character set dropdown (standard/dense/minimal), video/ASCII toggle, green-on-black terminal aesthetic, and viewport-filling ASCII display.</what-built>
  <how-to-verify>
**Desktop browser:**
1. Open the app, click Start Camera
2. Verify ASCII art appears in green on black background, filling the viewport width
3. Drag the resolution slider from 40 to 160 — verify the ASCII detail changes (40 = blocky, 160 = detailed)
4. Verify the column count label updates as you drag (e.g., "80 cols")
5. Switch character set dropdown to each option — verify each looks visually distinct
6. Toggle the video/ASCII switch — verify it switches between raw video and ASCII art
7. Check browser console for FPS logging (should show 30+ fps)
8. Stop camera — verify controls hide

**Mobile device (if available):**
9. Repeat steps 1-8 on mobile
10. Verify slider is usable on touch (no jank when dragging)
11. Verify ASCII output fills the mobile screen width
12. Verify Switch Camera button still works
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 3, or describe any issues to fix.</resume-signal>
</task>

</tasks>

<verification>
1. Resolution slider changes ASCII column count in real time (40-160 range, default 80)
2. Column count label shows current value (e.g., "80 cols")
3. Character set dropdown switches between standard, dense, and minimal — each visually distinct
4. Video/ASCII toggle switches between raw video and ASCII rendering
5. Controls appear when camera starts, hide when camera stops
6. FPS counter logs to browser console (not visible in UI)
7. Slider drag is smooth on mobile (throttled, no jank)
8. All existing functionality still works (camera start/stop, switch camera, visibility pause)
</verification>

<success_criteria>
- User can adjust ASCII resolution via slider with live column count label
- User can select character set from dropdown (3 distinct options)
- User can toggle between raw video and ASCII output
- Controls are below the output area
- Slider is throttled for mobile performance
- FPS logged to console for debugging
- All Phase 2 functionality intact
</success_criteria>

<output>
After completion, create `.planning/phases/03-ascii-rendering-engine/03-02-SUMMARY.md`
</output>
